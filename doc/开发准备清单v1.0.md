# 轨迹 App 开发准备清单 V1.0

> 依据《需求文档v1.0》《技术架构文档v1.0》《页面流程与原型说明v1.0》整理，用于开发前逐项准备。

---

## 一、开发环境与工具

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 1.1 | **DevEco Studio** | 使用支持 HarmonyOS NEXT 的最新版本，确保 Stage 模型与 ArkTS 支持 | 必做 |
| 1.2 | **HarmonyOS SDK** | 在 DevEco 中安装对应 API 版本（与 build-profile 一致） | 必做 |
| 1.3 | **真机或模拟器** | 轨迹记录、定位、地图需真机或支持定位的模拟器验证 | 必做 |

---

## 二、华为开发者与 AGC 控制台

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 2.1 | **华为开发者账号** | 注册并完成实名认证，用于 AGC、HMS 服务 | 必做 |
| 2.2 | **AGC 项目** | 在 [AppGallery Connect](https://developer.huawei.com/consumer/cn/service/josp/agc/index.html) 创建项目，包名与 `app.json5` 中 `bundleName` 一致（当前为 `com.lyf.aoyou`） | 必做 |
| 2.3 | **应用注册与 SHA-256** | 在 AGC 中添加应用，并配置签名证书指纹（SHA-256），用于 Auth、Cloud DB 等鉴权 | 必做 |

---

## 三、AGC 后端能力（BaaS）

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 3.1 | **认证服务 Auth** | 开通 AGC Auth，启用「华为账号」登录方式，与当前 App 关联（包名、签名） | 必做 |
| 3.2 | **云数据库 Cloud DB** | 开通 Cloud DB，按技术架构文档设计并创建对象类型（Object Type）：<br>• UserEntity<br>• TrackEntity<br>• TrackSegmentEntity<br>• TrackPointEntity<br>• TombSpotEntity<br>• PostEntity<br>（CommentEntity、FamilyMemberEntity 可 V2.0 再建） | 必做 |
| 3.3 | **云存储 Cloud Storage** | 开通 Cloud Storage，用于墓地照片、轨迹截图、分享海报等文件；规划存储路径与访问规则 | 必做 |
| 3.4 | **云函数 Cloud Functions** | 开通 Cloud Functions（可选 V1.0 简单场景），用于分享统计、权限校验等；可先预留，后续再写函数 | 可选 |

---

## 四、地图与定位（HMS Core）

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 4.1 | **地图服务 Map Kit** | 在 AGC 中启用 Map Kit，申请 API 密钥；用于 2D/3D 地图、轨迹线、墓地点标记 | 必做 |
| 4.2 | **定位服务 Location Kit** | 在 AGC 中启用 Location Kit；用于 GPS + 海拔采集、持续轨迹记录 | 必做 |
| 4.3 | **后台定位权限** | 若需上山途中持续记录，需申请后台定位相关权限与说明文案，并在 `module.json5` 中声明 | 按需 |

---

## 五、应用配置与签名

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 5.1 | **agconnect-services.json** | 从 AGC 控制台下载并放入 `entry/` 目录（当前已有，需确认包名、应用 ID 与 AGC 一致） | 必做 |
| 5.1.1 | **API Key 配置位置** | **无需单独配置**：API Key 已包含在 `agconnect-services.json` 的 `client.api_key` 中；AGC Auth、Cloud DB、Cloud Storage 会从该文件自动读取。Map Kit / Location Kit 若需显式设置，可在应用入口（如 EntryAbility）中通过 AGC 配置读取 `client/api_key` 后传入地图 SDK（具体以华为 Map Kit 文档为准） | 说明 |
| 5.2 | **签名证书** | 生成/使用 keystore，在 DevEco 与 AGC 中配置一致，避免 Auth/Cloud DB 鉴权失败 | 必做 |
| 5.3 | **权限声明** | 在 `module.json5` 的 `requestPermissions` 中声明：定位、网络、存储等；当前已有基础定位权限，按功能补齐 | 必做 |
| 5.4 | **网络权限** | 若未声明，需添加 `ohos.permission.INTERNET` 等网络相关权限（部分版本可能默认） | 必做 |

---

## 六、设计与资源

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 6.1 | **App 名称与品牌** | 确认应用名称「轨迹」、LOGO、splash 图（见页面流程 P0-1） | 可暂缓：先用工程默认图标/startIcon，名称在 string.json 改为「轨迹」即可，后续再换 |
| 6.2 | **底部 Tab 图标** | 首页、个人中心两个 Tab 的图标资源 | 可暂缓：用系统图标或占位图，后续再补 |
| 6.3 | **空状态插图/文案** | 「我的轨迹」「所有轨迹」无数据时的空状态（页面流程 3.0） | 可暂缓：先用文案或简单占位，后续再补插图 |
| 6.4 | **隐私政策与用户协议** | 登录页与个人中心需展示的协议链接或页面（需求 NFR-004、页面 P0-2、P3-1） | 建议先做占位页：两个简单页面展示「隐私政策」「用户协议」占位文案，链接指向应用内页，上架前再补正式内容 |

---

## 七、合规与说明

| 序号 | 准备项 | 说明 | 状态建议 |
|------|--------|------|----------|
| 7.1 | **隐私政策** | 明确轨迹与位置数据的用途、可见范围、存储与删除方式，符合隐私合规要求 | 必做 |
| 7.2 | **定位使用说明** | 在申请定位权限时向用户展示清晰说明（用于记录扫墓轨迹与墓地点位置） | 必做 |

---

## 八、当前工程可提前检查/补齐项

| 序号 | 检查项 | 说明 |
|------|--------|------|
| 8.1 | **依赖** | `oh-package.json5` 中尚未添加 AGC SDK（Auth、Cloud DB、Cloud Storage）、地图与定位相关依赖，需按技术架构在开发前引入 |
| 8.2 | **路由与页面** | `main_pages.json` 当前仅有 Index、Map，需按页面流程补充：登录页、首页（双 Tab）、新建/编辑轨迹、轨迹记录、轨迹详情、墓地点详情、个人中心等 |
| 8.3 | **多模块** | 已有 entry、location、map 等模块，**定位相关代码应放在 location 模块，地图相关代码应放在 map 模块**，entry 仅做入口与页面组装，通过依赖 location、map 使用其提供的接口/组件（见下「模块职责」） |
| 8.4 | **字符串资源** | `string.json` 中 `EntryAbility_label`、`module_desc` 等可改为「轨迹」相关文案，并补充各页面所需字符串 |

### 模块职责（定位 → location，地图 → map）

| 模块 | 职责 | 建议放置内容 |
|------|------|-----------------------------|
| **location** | 定位与轨迹点采集 | 定位权限请求、持续定位、单次定位、轨迹点采样（经纬度、海拔、时间戳）、轨迹点序列缓存；可对外导出服务类或组件供 entry 的轨迹记录页调用 |
| **map** | 地图展示与操作 | 地图初始化、2D/3D 切换、轨迹线（polyline）绘制、墓地点标记、当前位置显示、地图截图等；可对外导出地图组件供 entry 的轨迹记录页、轨迹详情页嵌入使用 |
| **entry** | 主入口与页面 | 登录、首页、新建/编辑轨迹、轨迹记录页、轨迹详情、墓地点详情、个人中心等**页面与路由**；在轨迹记录页、轨迹详情页中**引用** location 模块的定位能力与 map 模块的地图组件，不在 entry 中实现定位/地图具体逻辑 |

---

## 十、建议准备顺序（简要）

1. **环境**：安装 DevEco、HarmonyOS SDK，能跑通当前工程。
2. **账号与 AGC**：注册开发者账号 → 创建 AGC 项目 → 添加应用、配置签名。
3. **AGC 能力**：开通 Auth（华为账号）、Cloud DB（建表）、Cloud Storage，下载并配置 `agconnect-services.json`。
4. **地图与定位**：开通 Map Kit、Location Kit，在工程中集成 SDK 并配置 API Key。
5. **签名与权限**：确认签名与 AGC 一致，补齐 `module.json5` 权限与说明。
6. **设计与合规**：定稿 App 名称/LOGO、空状态、隐私政策与用户协议、定位说明文案。
7. **代码**：按页面流程补全路由与页面，按技术架构接入 Auth、Cloud DB、Cloud Storage 与地图定位。

---

> 完成上述准备后，即可按《页面流程与原型说明v1.0》从 P0 启动/登录、P1 轨迹主流程开始实现功能；遇到具体实现细节可再对照《需求文档v1.0》与《技术架构文档v1.0》逐条落地。

---

## 九、文档是否足够做完整开发 + 可暂缓项

**结论：当前文档（需求、技术架构、页面流程与原型、云数据库数据模型详细设计）已能支撑完整鸿蒙 App 开发。** 设计与资源（第六节）可不先准备：图标用默认/占位，隐私政策与用户协议先做占位页，后续再补。

**开发前仍需在工程内完成的项：**

| 类别 | 项 | 说明 |
|------|----|------|
| 依赖 | AGC + 地图/定位 SDK | `oh-package.json5` 中尚无 AGC（Auth、Cloud DB、Cloud Storage）及 Map Kit、Location Kit 依赖，需按技术架构引入 |
| 路由与页面 | main_pages.json + 页面文件 | 当前仅 Index、Map；需按页面流程补充：登录页、首页（双 Tab）、新建/编辑轨迹、轨迹记录、轨迹详情、墓地点详情、个人中心等 |
| 权限与配置 | INTERNET 等 | `module.json5` 已声明定位；若未声明需补 `ohos.permission.INTERNET`；定位说明文案（如 location_des）可改为与隐私一致 |
| 地图与定位 | Map Kit / Location Kit | 若尚未在 AGC 开通，需在控制台开通并配置 API 密钥，否则轨迹记录与地图展示无法实现 |

---

## 附录：权限申请清单（拿去逐项申请）

### 权限常量列表（可直接复制到 module.json5）

**定位相关：**
- `ohos.permission.LOCATION` — 精准定位（米级）
- `ohos.permission.APPROXIMATELY_LOCATION` — 模糊定位
- `ohos.permission.LOCATION_IN_BACKGROUND` — 后台定位（按需）

**网络相关：**
- `ohos.permission.INTERNET` — 使用网络（访问互联网）

**媒体/存储相关：**
- `ohos.permission.READ_MEDIA` — 读取相册/媒体
- `ohos.permission.WRITE_MEDIA` — 写入媒体/保存到相册（按需）
- `ohos.permission.CAMERA` — 使用相机（按需）

---

以下分为两类：**一、在华为/AGC 控制台开通的服务与 API**；**二、在应用内声明的系统权限**（含上架/审核时可能需填的说明）。按顺序去对应平台申请/配置即可。

### A. 在华为 / AGC 控制台需要“申请/开通”的项

| 序号 | 申请项 | 在哪里申请 | 申请时需准备/填写 | 用途 |
|------|--------|------------|-------------------|------|
| A1 | **华为开发者账号实名** | [华为开发者联盟](https://developer.huawei.com/consumer/cn/) | 身份证/企业信息、手机号 | 使用 AGC、HMS 的前提 |
| A2 | **AGC 项目与应用** | AppGallery Connect → 项目设置 → 添加项目/应用 | 包名：`com.lyf.aoyou`；应用名称；签名 SHA-256 | Auth、Cloud DB、Cloud Storage 鉴权 |
| A3 | **AGC Auth（华为账号登录）** | AGC → 构建 → 认证服务 | 启用「华为账号」登录方式，关联当前应用 | 用户登录 |
| A4 | **Cloud DB** | AGC → 构建 → 云数据库 | 创建对象类型（User、Track、TrackSegment、TrackPoint、TombSpot、Post 等） | 轨迹、墓地点、图文存储 |
| A5 | **Cloud Storage** | AGC → 构建 → 云存储 | 开通服务，规划存储路径/规则 | 墓地照片、分享图等文件 |
| A6 | **Map Kit（地图）** | AGC → 构建 → 地图服务 或 HMS Core 控制台 | 申请 API 密钥；填写应用包名、SHA-256 | 2D/3D 地图、轨迹线、墓地点标记 |
| A7 | **Location Kit（定位）** | AGC → 构建 → 位置服务 或 HMS Core 控制台 | 开通定位服务；部分场景需填写使用说明 | GPS + 海拔、轨迹记录 |
| A8 | **后台定位（若需要）** | 同上 + 应用内声明 `LOCATION_IN_BACKGROUND` | 使用场景说明：上山扫墓途中持续记录轨迹，需后台定位 | 用户切到其他应用时仍记录轨迹 |

说明：A6、A7 若在「HMS Core」或「我的项目」里按服务单独开通，需选对项目和应用，并保存好 API Key / 配置，用于工程中的 `agconnect-services.json` 或配置文件。

---

### B. 应用内需声明的系统权限（module.json5 + 说明文案）

以下权限需在 **entry/src/main/module.json5** 的 **requestPermissions** 中声明；带 **reason** 的需在 **resources/base/element/string.json** 中配置说明文案（用户弹窗或应用市场审核会看到）。**需要您“申请”的主要是：在应用市场或权限说明里填写「使用目的」时，可直接用下表「申请/说明文案」一列。**

| 序号 | 权限名称 | 类型 | 申请/说明文案（用于弹窗或应用市场） | 用途 |
|------|----------|------|-----------------------------------|------|
| B1 | `ohos.permission.INTERNET` | 系统授予（一般仅声明） | 用于同步轨迹数据、加载地图、上传照片到云端 | 访问网络 |
| B2 | `ohos.permission.LOCATION` | 用户授权 | 用于记录扫墓轨迹和墓地点位置，仅在前台使用 | 精准定位（米级） |
| B3 | `ohos.permission.APPROXIMATELY_LOCATION` | 用户授权 | 用于在地图上显示您的大致位置，辅助记录轨迹 | 模糊定位 |
| B4 | `ohos.permission.LOCATION_IN_BACKGROUND` | 用户授权（部分设备需在设置里“始终允许”） | 上山扫墓时若切换其他应用，仍可持续记录轨迹，避免中断 | 后台持续定位（按需） |
| B5 | `ohos.permission.READ_MEDIA` | 用户授权 | 用于选择相册中的墓地、祭扫照片并上传到轨迹记录 | 读取相册图片 |
| B6 | `ohos.permission.WRITE_MEDIA` 或 写媒体 | 用户授权 | 用于保存轨迹分享图、地图截图到相册 | 保存图片到相册（若需要） |
| B7 | `ohos.permission.CAMERA` | 用户授权 | 用于现场拍摄墓地、祭扫照片并添加到墓地点记录 | 拍照（若需要） |

**说明：**

- **B1**：网络权限多数为安装即授予，但需在 `module.json5` 中声明。
- **B2、B3**：当前工程已声明，请把 `reason`（如 `location_des`）的文案改成上表或与隐私政策一致的说法。
- **B4**：仅在上山途中需“切到其他应用仍记录”时申请；后台定位无法弹窗授予，需引导用户在「设置 → 应用 → 轨迹 → 权限」中设为「始终允许」。
- **B5、B6、B7**：按是否支持“选相册/拍照/保存到相册”功能决定是否声明；若 V1.0 只做选图上传，至少申请 **B5**，可选 **B7**。

---

### C. 您去申请时可直接复制的“使用目的”汇总

**定位（前台 + 模糊）：**  
「用于记录扫墓轨迹和墓地点位置，以及在地图上展示您的位置；仅在前台使用。」

**定位（后台，若申请）：**  
「上山扫墓时若切换到其他应用（如接电话、看消息），仍可持续记录轨迹，避免路径中断。」

**相册/媒体：**  
「用于选择相册中的墓地、祭扫照片并上传到轨迹与墓地点记录中。」

**相机（若申请）：**  
「用于现场拍摄墓地、祭扫照片并添加到墓地点图文记录中。」

**网络：**  
「用于同步轨迹数据、加载地图、上传/下载照片与云端数据。」

---

按上述 **A 表** 在华为/AGC 控制台逐项开通与申请，**B 表** 在工程里声明并配好说明文案，**C 段** 在应用市场或权限说明页填写即可。

